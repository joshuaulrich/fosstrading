<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Tactical asset allocation using blotter - FOSS Trading</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="Tactical asset allocation using blotter" />
<meta property="og:description" content="Hi, If I change to.monthly() to to.weekly() it se&hellip; Unknown - Nov 4, 2009
Hi,
If I change to.monthly() to to.weekly() it seems to die strangely. Any ideas?
Cheers,
-&mdash;&mdash;-
Error in if (!all(i &lt;= 0)) stop(&ldquo;only zeros may be mixed with negative subscripts&rdquo;) :
missing value where TRUE/FALSE needed
Calls: updateAcct -&gt; calcPortfSummary -&gt; time -&gt; [ -&gt; [.xts Thanks Josh for providing this nice example of the&hellip; pg - Nov 4, 2009" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://joshuaulrich.github.io/fosstrading/2009/11/tactical-asset-allocation-using-blotter-comments/" />
<meta property="article:published_time" content="2009-11-18T21:18:00-06:00" />
<meta property="article:modified_time" content="2009-11-18T21:18:00-06:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/fosstrading/css/style.css">
	<link rel="stylesheet" href="/fosstrading/fosstrading.css">
	<link rel="shortcut icon" href="/fosstrading/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-3314405-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/fosstrading/" title="FOSS Trading" rel="home">
				<div class="logo__title">FOSS Trading</div>
				<div class="logo__tagline">Algorithmic Trading with Free Open Source Software</div>
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="">
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="page/disclosures/">
				
				<span class="menu__text">Disclosures</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="page/enterprise/">
				
				<span class="menu__text">For Enterprise</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Tactical asset allocation using blotter</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2009-11-18T21:18:00-06:00">November 18, 2009</time></div></div>
		</header><div class="content post__content clearfix">
			

<h4 id="hi-if-i-change-to-monthly-to-to-weekly-it-se">Hi, If I change to.monthly() to to.weekly() it se&hellip;</h4>

<p><a href="https://www.blogger.com/profile/12339660005815965945" title="noreply@blogger.com">Unknown</a> - <time datetime="2009-11-26T06:47:48.072-06:00">Nov 4, 2009</time></p>

<p>Hi,</p>

<p>If I change to.monthly() to to.weekly() it seems to die strangely. Any ideas?</p>

<p>Cheers,<br />
-&mdash;&mdash;-<br />
Error in if (!all(i &lt;= 0)) stop(&ldquo;only zeros may be mixed with negative subscripts&rdquo;) :<br />
missing value where TRUE/FALSE needed<br />
Calls: updateAcct -&gt; calcPortfSummary -&gt; time -&gt; [ -&gt; [.xts
<hr /></p>

<h4 id="thanks-josh-for-providing-this-nice-example-of-the">Thanks Josh for providing this nice example of the&hellip;</h4>

<p><a href="https://www.blogger.com/profile/03166547932461080321" title="noreply@blogger.com">pg</a> - <time datetime="2009-11-26T10:27:59.293-06:00">Nov 4, 2009</time></p>

<p>Thanks Josh for providing this nice example of the use of blotter.</p>

<p>Just as a side note: shouldn&rsquo;t you be using adjusted (for dividends) prices for both ETFs ? I did that, and while the return on the buy-and-hold strategy increased substantially, the risk-return profile continued favorable to the tactical allocation (with max drawdown of just above 3.5%).<br />
rgds.
<hr /></p>

<h4 id="aaron-the-problem-you-got-is-probably-due-to-time">Aaron, the problem you got is probably due to time&hellip;</h4>

<p><a href="https://www.blogger.com/profile/03166547932461080321" title="noreply@blogger.com">pg</a> - <time datetime="2009-11-26T14:18:16.442-06:00">Nov 4, 2009</time></p>

<p>Aaron, the problem you got is probably due<br />
to time zone problems. In the updatePortf() function there is a call to<br />
as.POSIXct(), which converts to your local time zone. Then, when you compare back to, let&rsquo;s say, time(IEF) you will not get compatible date-time stamps !</p>

<p>Josh, is it possible to make blotter functions robust to different time-zones ?
<hr /></p>

<h4 id="aaron-as-pg-mentioned-it-s-due-to-timezone">Aaron, As pg mentioned, it&rsquo;s due to timezone &hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2009-11-29T19:27:44.377-06:00">Nov 1, 2009</time></p>

<p>Aaron,</p>

<p>As pg mentioned, it&rsquo;s due to timezone issues when converting from a &ldquo;Date&rdquo; class to &ldquo;POSIXct&rdquo;. The fix is to add drop.time=FALSE to the to.weekly() call.</p>

<p>pg,</p>

<p>Timezone issues are just plain hard. blotter uses xts, which aims to be robust to timezone differences. The above issue will be addressed in a future xts release.</p>

<p>And yes, I probably should have adjusted the series for splits and dividends. You can do that with the adjustOHLC() function in quantmod.</p>

<p>Thanks for the comments!
<hr /></p>

<h4 id="hi-very-good-work-when-i-run-your-codes-on-my-ow">Hi very good work. When I run your codes on my ow&hellip;</h4>

<p><a href="https://www.blogger.com/profile/02835246221017053386" title="noreply@blogger.com">gamma_sf</a> - <time datetime="2009-12-18T21:09:44.219-06:00">Dec 6, 2009</time></p>

<p>Hi very good work.</p>

<p>When I run your codes on my own, I get this error &ldquo;improper length of one or more arguments to merge.xts&rdquo;. Do you have a suggestion to fix it?
<hr /></p>

<h4 id="gamma-without-more-information-i-have-no-idea-w">gamma, Without more information, I have no idea w&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2009-12-19T12:28:43.380-06:00">Dec 6, 2009</time></p>

<p>gamma,</p>

<p>Without more information, I have no idea where to start. What line caused the error? What version of R, xts, quantmod, etc. are you using? Did you run this code in a clean environment?
<hr /></p>

<h4 id="sorry-i-m-using-r-2-10-0-version-and-the-line">sorry, I&rsquo;m using R 2.10.0 version and the line&hellip;</h4>

<p><a href="https://www.blogger.com/profile/02835246221017053386" title="noreply@blogger.com">gamma_sf</a> - <time datetime="2009-12-21T22:04:58.597-06:00">Dec 2, 2009</time></p>

<p>sorry, I&rsquo;m using R 2.10.0 version and the lines causing errors are:<br />
[1] &ldquo;Setting up indicators&rdquo;<br />
&gt; IEF$SMA &lt;- SMA(Cl(IEF), 10)<br />
Error in error(x, &hellip;) :<br />
improper length of one or more arguments to merge.xts<br />
&gt; SPY$SMA &lt;- SMA(Cl(SPY), 10)<br />
Error in error(x, &hellip;) :<br />
improper length of one or more arguments to merge.xts<br />
&gt;<br />
&gt; x &lt;- SMA(Cl(IEF), 10)<br />
&gt; y &lt;- SMA(Cl(SPY), 10)<br />
&gt;<br />
&gt; IEF &lt;- merge(IEF, x)<br />
Error in error(x, &hellip;) :<br />
improper length of one or more arguments to merge.xts
<hr /></p>

<h4 id="gamma-it-seems-that-you-re-not-running-the-c">gamma, It seems that you&rsquo;re not running the c&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2009-12-22T11:58:49.741-06:00">Dec 2, 2009</time></p>

<p>gamma,</p>

<p>It seems that you&rsquo;re not running the code I&rsquo;ve posted above. This is evidenced by the lines you posted that use &ldquo;&lt;-&rdquo; instead of &ldquo;=&rdquo; for assignment (as I did). That&rsquo;s not to imply that the choice of assignment operator is causing issues, but instead that I can&rsquo;t debug changes you&rsquo;ve made.</p>

<p>I just re-ran the code in the post with R-2.10.1 using the most recent version of xts from both CRAN and r-forge. I had no errors or warnings.</p>

<p>I&rsquo;d be happy to look at your code, if you&rsquo;d like. Please email it to me at josh m ulrich at gmail (replace the spaces before @ with dots).
<hr /></p>

<h4 id="josh-thank-you-for-this-nice-introduction-to-blot">Josh, thank you for this nice introduction to blot&hellip;</h4>

<p><a href="https://www.blogger.com/profile/02226069659408585327" title="noreply@blogger.com">Unknown</a> - <time datetime="2010-01-06T02:26:12.263-06:00">Jan 3, 2010</time></p>

<p>Josh, thank you for this nice introduction to blotter. Helps me a lot getting started.</p>

<p>Cheers<br />
Simon
<hr /></p>

<h4 id="hi-executed-portfolio-initportf-symbols-initd">Hi Executed: portfolio = initPortf(symbols, initD&hellip;</h4>

<p><a href="https://www.blogger.com/profile/12965174785718327168" title="noreply@blogger.com">Stephen</a> - <time datetime="2010-01-19T20:53:07.181-06:00">Jan 3, 2010</time></p>

<p>Hi</p>

<p>Executed:<br />
portfolio = initPortf(symbols, initDate=initDate)</p>

<p>Received following error:<br />
Error in vector(&ldquo;list&rdquo;, length = length(symbols)) : element 1 is empty; the part of the args list of &lsquo;length&rsquo; being evaluated was: (symbols)</p>

<p>Any help would be appreciated. I have executed the code as typed on your blog.
<hr /></p>

<h4 id="hi-stephen-there-s-been-a-lot-of-activity-in">Hi Stephen, There&rsquo;s been a lot of activity in&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-01-19T21:12:12.374-06:00">Jan 3, 2010</time></p>

<p>Hi Stephen,</p>

<p>There&rsquo;s been a lot of activity in the blotter repository in the past couple weeks. The code should still work with revision 120, but later revisions may have issues with the code as posted.</p>

<p>So, use revision 120 if you&rsquo;re comfortable building from source. If not, give me a couple days to figure out what&rsquo;s changed in the most recent revisions.</p>

<p>Best,<br />
Josh
<hr /></p>

<h4 id="the-code-is-now-updated-to-work-with-revision-193">The code is now updated to work with revision 193&hellip;.</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-01-20T19:07:33.735-06:00">Jan 4, 2010</time></p>

<p>The code is now updated to work with revision 193.
<hr /></p>

<h4 id="josh-not-sure-if-this-is-a-version-error-or-what">Josh- not sure if this is a version error or what &hellip;</h4>

<p><a href="https://www.blogger.com/profile/02243091796264106946" title="noreply@blogger.com">RepentantBankster</a> - <time datetime="2010-02-06T13:21:28.468-06:00">Feb 6, 2010</time></p>

<p>Josh- not sure if this is a version error or what but, when running your program I keep getting these error even after I dump all workspace objects.</p>

<p>[1] &ldquo;Initializing portfolio and account structure&rdquo;<br />
&gt; portfolio = initPortf(symbols=symbols, initDate=initDate)<br />
Error in initPortf(symbols = symbols, initDate = initDate) :<br />
Portfolio default already exists, use updatePortf() or addPortfInstr() to update it.<br />
&gt; account = initAcct(portfolios=&lsquo;default&rsquo;, initDate=initDate)<br />
Error in initAcct(portfolios = &ldquo;default&rdquo;, initDate = initDate) :<br />
Account default already exists, use updateAcct() or create a new account.</p>

<p>additionally this pops up later because &lsquo;account&rsquo; is not defined</p>

<p>+ } # End dates loop<br />
Error in getEndEq(account, CurrentDate) : object &lsquo;account&rsquo; not found</p>

<p>If you could shed any light on the first error I would be relieved. I have just started using R and am still getting used to all of its functions.
<hr /></p>

<h4 id="hi-zachary-that-could-be-a-version-issue-i-jus">Hi Zachary, That could be a version issue. I jus&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-02-06T21:14:10.297-06:00">Feb 0, 2010</time></p>

<p>Hi Zachary,</p>

<p>That could be a version issue. I just ran the example using revision 232 without error. It&rsquo;s hard to say what&rsquo;s causing your issue without more information. Feel free to email me if you&rsquo;d like more help.</p>

<p>Best,<br />
Josh
<hr /></p>

<h4 id="convert-data-to-monthly-frequency-to-weekl">&gt; # Convert data to monthly frequency (to.weekl&hellip;</h4>

<p><a href="https://www.blogger.com/profile/18403699889033818605" title="noreply@blogger.com">Unknown</a> - <time datetime="2010-03-03T18:41:32.460-06:00">Mar 4, 2010</time></p>

<p>&gt; # Convert data to monthly frequency (to.weekly() needs drop.time=FALSE)</p>

<p>&gt; IEF = to.monthly(IEF, indexAt=&lsquo;endof&rsquo;)</p>

<p>Error in to.period(x, &ldquo;months&rdquo;, indexAt = indexAt, name = name, &hellip;) :<br />
NA/NaN/Inf in foreign function call (arg 3)<br />
Calls: to.monthly -&gt; to.period -&gt; .Fortran<br />
In addition: Warning message:<br />
In to.period(x, &ldquo;months&rdquo;, indexAt = indexAt, name = name, &hellip;) :<br />
missing values removed from data</p>

<p>How do I fix this?
<hr /></p>

<h4 id="judsonm123-as-i-ve-said-to-others-without-m">judsonm123, As I&rsquo;ve said to others: without m&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-03-03T19:56:41.340-06:00">Mar 4, 2010</time></p>

<p>judsonm123,</p>

<p>As I&rsquo;ve said to others: without more information, I have no idea what&rsquo;s causing your error or how to fix it.</p>

<p>Best,<br />
Josh
<hr /></p>

<h4 id="hi-thanks-for-this-great-example-i-ran-across">Hi, Thanks for this great example. I ran across &hellip;</h4>

<p><a href="https://www.blogger.com/profile/06415469239466265644" title="noreply@blogger.com">SP</a> - <time datetime="2010-03-04T09:12:05.724-06:00">Mar 4, 2010</time></p>

<p>Hi,</p>

<p>Thanks for this great example.</p>

<p>I ran across this error:<br />
&rdquo;<br />
&gt; # Plot Strategy Summary<br />
&gt; png(filename=&ldquo;20091118_blotter_strategy.png&rdquo;, 720, 720)<br />
&gt; charts.PerformanceSummary(ROC(getAccount(account)$TOTAL$End.Eq)[-1],main=&ldquo;Tactical Asset Allocation&rdquo;)<br />
Error in `[.xts`(x, start.row, 1) : subscript out of bounds<br />
&gt; dev.off()<br />
null device<br />
1 &ldquo;</p>

<p>Any ideas what might be the problem?</p>

<p>Thanks in advance.</p>

<p>Kind regards,<br />
Nim.
<hr /></p>

<h4 id="nim-sorry-it-was-a-bug-in-the-code-caused-by-so">Nim, Sorry, it was a bug in the code caused by so&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-03-07T15:44:24.778-06:00">Mar 0, 2010</time></p>

<p>Nim,</p>

<p>Sorry, it was a bug in the code caused by some recent updates to blotter on R-forge. The example works now.
<hr /></p>

<h4 id="josh-thanks-for-posting-the-example-i-ve-be">Josh, Thanks for posting the example. I&rsquo;ve be&hellip;</h4>

<p><a href="https://www.blogger.com/profile/10432286752304075125" title="noreply@blogger.com">Unknown</a> - <time datetime="2010-04-13T20:32:45.967-05:00">Apr 3, 2010</time></p>

<p>Josh,<br />
Thanks for posting the example. I&rsquo;ve been working with this example and ran into the same error as judsonm123. It appears that IEF = adjustOHLC(IEF) results in NAs for the OHLC columns which then creates an error in to.monthly and SMA calculations. I&rsquo;m running R 2.10.1 with the latest required libraries. I&rsquo;m still trying to figure it out but I thought I&rsquo;d let you know.</p>

<p>Best Regards,<br />
Trey
<hr /></p>

<h4 id="trey-thanks-for-the-information-it-looks-like">Trey, Thanks for the information. It looks like &hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-04-13T21:57:41.262-05:00">Apr 3, 2010</time></p>

<p>Trey,</p>

<p>Thanks for the information. It looks like something changed in merge.xts that is affecting the adjustment algorithm. I&rsquo;m busy preparing for, and attending, <a href="http://www.rinfinance.com/">R/Finance 2010</a>, so I won&rsquo;t be able to dig into this further until next week. Thanks for the report.</p>

<p>Best,<br />
Josh
<hr /></p>

<h4 id="josh-i-changed-the-code-to-the-following-ief">Josh, I changed the code to the following: IEF =&hellip;</h4>

<p><a href="https://www.blogger.com/profile/10432286752304075125" title="noreply@blogger.com">Unknown</a> - <time datetime="2010-04-29T10:12:15.823-05:00">Apr 4, 2010</time></p>

<p>Josh,<br />
I changed the code to the following: IEF = adjustOHLC(IEF, use.Adjusted=TRUE) and I did the same for SPY. Everything worked fine. The documentation does state that this method is less accurate.</p>

<p>As is, this system isn&rsquo;t tradable. I&rsquo;m not sure if you intended that or not. In my opinion, it&rsquo;s important to make sure that a back-test is actually tradable, in the sense that it could actually be executed in real time. The rule is &ldquo;If Close &gt; SMA buy on close&rdquo;. The values are determined after the market has closed which requires you buy at the next bar, not that bar close. In this example, that would be the open of the following month. It seems that we would need to switch to daily for the entry. I&rsquo;ll see what I can do. Thanks again for the code and I hope this helps.</p>

<p>Are the presentations from R/Fin 2010 going to posted with prior years?
<hr /></p>

<h4 id="trey-yes-that-will-work-until-i-can-fix-the-adj">Trey, Yes, that will work until I can fix the adj&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-04-29T10:26:36.743-05:00">Apr 4, 2010</time></p>

<p>Trey,</p>

<p>Yes, that will work until I can fix the adjustment algorithm. Accuracy is only an issue for securities with many splits and/or dividends over an extended period of time.</p>

<p>You&rsquo;re correct that <em>code</em> couldn&rsquo;t be executed in real-time. That said, this strategy trades very infrequently and you would generally know well ahead of time whether the month-end close would be above/below the SMA, so you <em>could</em> enter the trades at the month-end close. Your observation is <em>very</em> important at higher frequencies, however.</p>

<p>The R/Finance 2010 presentations should be on the website in a few weeks. I&rsquo;ll post when they&rsquo;re available.
<hr /></p>

<h4 id="josh-i-just-downloaded-the-latest-macos-x-leopard">Josh, I just downloaded the latest MacOS X Leopard&hellip;</h4>

<p><a href="https://www.blogger.com/profile/01349972242888715865" title="noreply@blogger.com">G$</a> - <time datetime="2010-05-09T22:00:17.156-05:00">May 1, 2010</time></p>

<p>Josh, I just downloaded the latest MacOS X Leopard binary for blotter and am trying to follow the example so I can use the package with my Fixed Income Calendar Effects strategy, but I am getting some environment errors such as:</p>

<p>Error in updatePosPL(Portfolio = pname, Symbol = as.character(symbol), :<br />
could not find function &ldquo;getPrice&rdquo;</p>

<p>Am I missing an installed package, or do I have to do something to expose the getPrice function?
<hr /></p>

<h4 id="g-getprice-is-in-quantmod-run-update-packages">G$, getPrice is in quantmod. Run update.packages&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-05-09T22:03:42.652-05:00">May 1, 2010</time></p>

<p>G$,</p>

<p>getPrice is in quantmod. Run update.packages(). If that doesn&rsquo;t work, get the most recent version of quantmod from R-forge.
<hr /></p>

<h4 id="sorry-i-did-download-the-latest-off-r-forge-vers">Sorry, I did download the latest off r-forge, vers&hellip;</h4>

<p><a href="https://www.blogger.com/profile/01349972242888715865" title="noreply@blogger.com">G$</a> - <time datetime="2010-05-09T23:17:37.872-05:00">May 1, 2010</time></p>

<p>Sorry, I did download the latest off r-forge, version 03.03-14.</p>

<p>I loaded the package, library(quantmod)</p>

<p>I can&rsquo;t find any getPrice.R in the R directory, neither can I use help(getPrice) to find any documentation for it to pull from the man directory. I do see a getQuote?
<hr /></p>

<h4 id="getprice-isn-t-exported-which-is-why-you-can">getPrice isn&rsquo;t exported, which is why you can&amp;&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-05-10T08:10:47.726-05:00">May 1, 2010</time></p>

<p>getPrice isn&rsquo;t exported, which is why you can&rsquo;t find it via the methods you tried. It&rsquo;s in the source file Price.transformations.R (functions do not need to be in a file of the same name).</p>

<p>quantmod:::getPrice will show you the source code from the R console.
<hr /></p>

<h4 id="g-quantmod-getprice-is-in-the-most-recent-mac">G$, quantmod:::getPrice is in the most recent Mac&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-06-04T13:21:19.077-05:00">Jun 5, 2010</time></p>

<p>G$,</p>

<p>quantmod:::getPrice is in the most recent MacOS X binary of quantmod on R-forge (I just looked). I have no idea what you could be doing wrong.
<hr /></p>

<h4 id="thanks-josh-i-got-it-to-work-there-was-an-odd-m">Thanks Josh, I got it to work. There was an odd m&hellip;</h4>

<p><a href="https://www.blogger.com/profile/01349972242888715865" title="noreply@blogger.com">G$</a> - <time datetime="2010-06-10T12:01:52.327-05:00">Jun 4, 2010</time></p>

<p>Thanks Josh, I got it to work. There was an odd masking going on I was able to clear out. It works beautifully.
<hr /></p>

<h4 id="zachary-i-have-the-same-problem-i-can-run-the-s">Zachary, I have the same problem. I can run the s&hellip;</h4>

<p><a href="https://www.blogger.com/profile/17087416729361204935" title="noreply@blogger.com">Unknown</a> - <time datetime="2010-07-31T15:33:02.950-05:00">Jul 6, 2010</time></p>

<p>Zachary,<br />
I have the same problem. I can run the script once, but it fails on subsequent attempts because the portfolio already exists. One way I found to remedy the issue is to cleanup the workspace.</p>

<p># Reset the workspace by deleting all variables and recreating<br />
# the environment variables created during library load<br />
rm(list=ls(all=TRUE))<br />
.blotter &lt;- new.env()<br />
.instrument &lt;- new.env()</p>

<p>-Ben<br />
benmccann.com
<hr /></p>

<h4 id="another-alternative-for-cleaning-up-the-environmen">Another alternative for cleaning up the environmen&hellip;</h4>

<p><a href="https://www.blogger.com/profile/17087416729361204935" title="noreply@blogger.com">Unknown</a> - <time datetime="2010-08-16T19:25:07.661-05:00">Aug 2, 2010</time></p>

<p>Another alternative for cleaning up the environment would be:<br />
rm(list=ls(all=TRUE, pos=.blotter), pos=.blotter)<br />
rm(list=ls(all=TRUE, pos=.instrument), pos=.instrument)
<hr /></p>

<h4 id="hi-i-could-use-some-help-in-getting-the-example">Hi - I could use some help in getting the example &hellip;</h4>

<p><a href="https://www.blogger.com/profile/02863487227658028225" title="noreply@blogger.com">SWAustinGuy</a> - <time datetime="2010-10-10T18:56:54.137-05:00">Oct 0, 2010</time></p>

<p>Hi -<br />
I could use some help in getting the example &lsquo;longtrend&rsquo; working in R-2.11.1, and the latest blotter, xts, quantmod, from R-forge (just updated all packages today).</p>

<p>I&rsquo;m running Win7 (but don&rsquo;t have to if it&rsquo;s an issue). The problem I am having is in updatePortf()<br />
I get the following error</p>

<p>[1] &ldquo;2001-04-30 IEF 578 @ 86.39&rdquo;<br />
Symbol IEF Date: 988588800 TxnPrice 86.39 Qty 578<br />
Here</p>

<p>Error in if (ncol(Prices) &gt; 1) Prices = getPrice(prices, Symbol)[dateRange] :<br />
argument is of length zero</p>

<p>It appears as if everything is working correctly except for the update to the portfolio. I&rsquo;ve dumped my enironment, version info, code I am running (from example), error message, data frame for underlying symbol IEF, and the error I get when trying to manually add a transaction and update portfolio on the command line of &lsquo;R&rsquo;.</p>

<p><a href="http://oeo.la/T2zHyC">http://oeo.la/T2zHyC</a></p>

<p>I&rsquo;m very new to &lsquo;R&rsquo;, so I hope to have captured all relevant information and thank anyone in advance that might be able to steer me in the right direction.</p>

<p>Great blog - Thanks allot for sharing this.
<hr /></p>

<h4 id="hmm-if-i-change-the-following-line-in-updateportf">Hmm, if I change the following line in updatePortf&hellip;</h4>

<p><a href="https://www.blogger.com/profile/02863487227658028225" title="noreply@blogger.com">SWAustinGuy</a> - <time datetime="2010-10-10T19:51:46.854-05:00">Oct 1, 2010</time></p>

<p>Hmm, if I change the following line in updatePortf (Dates=&hellip;, the code runs much further, executing a few hundred trades, then failing.</p>

<p>old:<br />
updatePortf(ltportfolio, Dates = CurrentDate)</p>

<p>new:<br />
updatePortf(Portfolio=&lsquo;default&rsquo;, Dates=paste(&rsquo;::&lsquo;,as.Date(Sys.time()),sep=&ldquo;))</p>

<p>Then fails with:<br />
[1] &ldquo;2007-05-31 IEF -611 @ 91.45&rdquo;<br />
Error in `[.xts`(sym, i, ) : subscript out of bounds</p>

<p>Is the date thing an issue in Windows?
<hr /></p>

<h4 id="swaustinguy-i-ve-spoken-with-brian-and-we-be">SWAustinGuy, I&rsquo;ve spoken with Brian and we be&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2010-10-11T11:29:12.396-05:00">Oct 1, 2010</time></p>

<p>SWAustinGuy,</p>

<p>I&rsquo;ve spoken with Brian and we believe the error is in r411 of blotter and has been fixed in r412. But you didn&rsquo;t get the fix because the Windows binary of r412 has not been built on R-forge yet. Please try again once you see &ldquo;Rev: 412&rdquo; for blotter on <a href="https://r-forge.r-project.org/R/?group_id=316">this page</a>.</p>

<p>Sorry for the trouble.
<hr /></p>

<h4 id="works-fine-on-my-linux-slice-but-i-noticed-install">Works fine on my linux slice but I noticed install&hellip;</h4>

<p><a href="https://www.blogger.com/profile/14106507531967201905" title="noreply@blogger.com">Unknown</a> - <time datetime="2010-11-06T18:25:28.032-05:00">Nov 6, 2010</time></p>

<p>Works fine on my linux slice but I noticed install blotter is blowing up on my mac. - <a href="https://r-forge.r-project.org/R/?group_id=316&amp;log=build_mac&amp;pkg=FinancialInstrument&amp;flavor=patched">https://r-forge.r-project.org/R/?group_id=316&amp;log=build_mac&amp;pkg=FinancialInstrument&amp;flavor=patched</a></p>

<p>Just wanted to throw out a heads up.
<hr /></p>

<h4 id="ok-i-can-get-the-returns-and-see-the-actual-data">Ok, I can get the returns and see the actual data &hellip;</h4>

<p><a href="https://www.blogger.com/profile/09631681950518688098" title="noreply@blogger.com">The Prolific Programmer</a> - <time datetime="2011-04-15T17:37:15.162-05:00">Apr 5, 2011</time></p>

<p>Ok, I can get the returns and see the actual data structures. But the code crashes at the first chartSeries line. So, I tried looking at getAccount(&lsquo;default&rsquo;), which looks like:</p>

<p># from head(getAccount(&lsquo;default&rsquo;))<br />
$portfolios<br />
$portfolios$default<br />
Long.Value Short.Value Net.Value Gross.Value Realized.PL<br />
2002-07-31 0.0 0 0.0 0.0 0.00<br />
2003-04-30 199951.3 0 199951.3 199951.3 0.00<br />
2003-05-30 208813.3 0 208813.3 208813.3 0.00<br />
2003-06-30 208558.1 0 208558.1 208558.1 0.00<br />
2003-07-31 108136.3 0 108136.3 108136.3 -3482.57<br />
2003-08-29 110366.7 0 110366.7 110366.7 0.00<br />
2003-09-30 212134.1 0 212134.1 212134.1 0.00<br />
2003-10-31 114566.4 0 114566.4 114566.4 -2376.06<br />
2003-11-28 115817.6 0 115817.6 115817.6 0.00<br />
2003-12-31 121072.6 0 121072.6 121072.6 0.00<br />
2004-01-30 123466.2 0 123466.2 123466.2 0.00<br />
2004-02-27 233925.2 0 233925.2 233925.2 0.00<br />
2004-03-31 232928.0 0 232928.0 232928.0 0.00<br />
2004-04-30 120724.5 0 120724.5 120724.5 -3990.90<br />
2004-05-28 122791.7 0 122791.7 122791.7 0.00<br />
2004-06-30 124608.6 0 124608.6 124608.6 0.00<br />
2004-07-30 0.0 0 0.0 0.0 20595.84<br />
2004-08-31 105362.5 0 105362.5 105362.5 0.00<br />
2004-09-30 105374.8 0 105374.8 105374.8 0.00<br />
2004-10-29 211374.7 0 211374.7 211374.7 0.00
<hr /></p>

<h4 id="second-on-hasan-s-error-the-whole-script-run">Second on Hasan&rsquo;s error - the whole script run&hellip;</h4>

<p><a href="https://www.blogger.com/profile/01969924423785517132" title="noreply@blogger.com">Elihu</a> - <time datetime="2011-08-31T00:04:00.295-05:00">Aug 3, 2011</time></p>

<p>Second on Hasan&rsquo;s error - the whole script runs up until:</p>

<p>&ldquo;charts.PerformanceSummary(ROC(getAccount(&lsquo;default&rsquo;)$TOTAL$End.Eq)[-1],main=&ldquo;Tactical Asset Allocation&rdquo;)</p>

<p>Then R throws &ldquo;Error in dim(data) &lt;- dim : attempt to set an attribute on NULL.&rdquo;</p>

<p>I&rsquo;m running R 2.13.1 (installed today) in RStudio, and I just ran the update.packages() script mentioned above.</p>

<p>Thanks Josh for the great tutorial!
<hr /></p>

<h4 id="hasan-and-elihu-sorry-for-the-extremely-slow-rep">Hasan and Elihu, Sorry for the extremely slow rep&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2011-09-25T12:28:55.475-05:00">Sep 0, 2011</time></p>

<p>Hasan and Elihu,</p>

<p>Sorry for the extremely slow reply. I&rsquo;ve corrected the code to work with more recent versions of blotter. Also see the update at the top of the post.</p>

<p>Best,<br />
Josh
<hr /></p>

<h4 id="thanks-for-the-nice-example-but-there-s-diffe">Thanks for the nice example, but there&rsquo;s diffe&hellip;</h4>

<p><a href="https://www.blogger.com/profile/04233325205386980154" title="noreply@blogger.com">segaa</a> - <time datetime="2011-10-31T20:49:23.914-05:00">Nov 2, 2011</time></p>

<p>Thanks for the nice example, but there&rsquo;s differently an error in the calculations of return for tactical strategy, as an example here are several lines of results that I&rsquo;ve got from the strategy:<br />
Date Symbol Size Price Change Total<br />
0 0 0 0 0 100000<br />
4/30/2003 IEF 578 86.39 49933.42 50066.58<br />
4/30/2003 SPY 544 91.91 49999.04 67.54<br />
7/31/2003 IEF -578 83.38 -48193.6 48261.18<br />
9/30/2003 IEF 597 86.59 51694.23 -3433.05<br />
10/31/2003 IEF -597 84.6 -50506.2 47073.15</p>

<p>When second position opened in IEF on 9/30/2003 there&rsquo;s -3422.05 left at the account that suppose to never go below 0. I understand that we can borrow money on margin, but this is not the case for the strategy, and I see several instances in the results when buy made on margin. Probably because of that at the end of the last term the return if calculated manually is more like 17%, and not 22.7% as per the script result.<br />
Sorry, maybe I&rsquo;m missing something, please point it if so. FYI, I&rsquo;m using R version 2.13.2<br />
Thanks again for the great job!
<hr /></p>

<h4 id="seega-i-don-t-where-you-re-getting-those">seega, I don&rsquo;t where you&rsquo;re getting those&hellip;</h4>

<p><a href="https://www.blogger.com/profile/16641971932645230429" title="noreply@blogger.com">Joshua Ulrich</a> - <time datetime="2011-11-01T20:45:13.735-05:00">Nov 3, 2011</time></p>

<p>seega,</p>

<p>I don&rsquo;t where you&rsquo;re getting those numbers. I just ran the script myself and cannot replicate what you&rsquo;ve shown in your comment.
<hr /></p>

<h4 id="joshua-thanks-a-lot-for-your-reply-my-results-ar">Joshua, thanks a lot for your reply! My results ar&hellip;</h4>

<p><a href="https://www.blogger.com/profile/04233325205386980154" title="noreply@blogger.com">segaa</a> - <time datetime="2011-11-08T19:33:22.468-06:00">Nov 3, 2011</time></p>

<p>Joshua, thanks a lot for your reply! My results are 100% reproducible to me. The code is similar to yours, I&rsquo;ve just added the following 3 lines at the top, before loading the libraries, to make the code independent of the workspace:<br />
rm(list=ls(all=TRUE))<br />
if(!exists(&lsquo;.instrument&rsquo;)) .instrument &lt;&lt;- new.env(hash=TRUE)<br />
if(!exists(&lsquo;.blotter&rsquo;)) .blotter &lt;&lt;- new.env(hash=TRUE)<br />
As verbose = TRUE I can see the results of the strategy allocations in the console output, I&rsquo;ve just ran it again and got the following:<br />
&hellip; SKIP &hellip;<br />
+ } # End dates loop<br />
[1] &ldquo;2003-04-30 IEF 578 @ 86.39&rdquo;<br />
[1] &ldquo;2003-04-30 SPY 544 @ 91.91&rdquo;<br />
[1] &ldquo;2003-07-31 IEF -578 @ 83.38&rdquo;<br />
[1] &ldquo;2003-09-30 IEF 597 @ 86.59&rdquo;<br />
[1] &ldquo;2003-10-31 IEF -597 @ 84.6&rdquo;<br />
[1] &ldquo;2004-02-27 IEF 627 @ 86.68&rdquo;<br />
[1] &ldquo;2004-04-30 IEF -627 @ 83.5&rdquo;<br />
&hellip; SKIP &hellip;<br />
The generated PNG images are absolutely the same as in your post.<br />
If I understand correctly:<br />
1. we&rsquo;ve bought 578 shares of IEF on 2003-04-30 at $86.39 that leaves $50066.58 at our account unused.<br />
2. than we&rsquo;ve bot 544 shares of SPY at $91.91 that leaves us with $67.54 on account<br />
3. on 2003—07-31 we&rsquo;ve closed our IEF position with loss at $83.38 that leaves $48261.18 at our account<br />
4. next, we are buying 597 shares of IEF at $86.59 that leaves us with minus $3433.05 etc.</p>

<p>Maybe I&rsquo;m misunderstanding something, please clarify. Thanks!
<hr /></p>

<h4 id="the-script-itself-says-note-for-the-purp">The script itself says: &ldquo;NOTE: For the purp&hellip;</h4>

<p><a href="https://www.blogger.com/profile/09226525229201110236" title="noreply@blogger.com">Brian G. Peterson</a> - <time datetime="2011-11-08T21:00:59.481-06:00">Nov 3, 2011</time></p>

<p>The script itself says:</p>

<p>&ldquo;NOTE: For the purposes of this demo, we ignore interest and leverage.&rdquo;</p>

<p>It doe *not* say &ldquo;for the purposes of this demo, we use no leverage&rdquo;.</p>

<p>In basically all institutional accounts and in many retail accounts, open equity is essentially equivalent to cash, and it would be fine to use the ending equity, including any open equity, to decide on the sizing of any new positions.</p>

<p>In any event, patches are always welcome to extract available cash and use that instead (ending equity minus position values in a long-only portfolio, as I recall).
<hr /></p>

<h4 id="thanks-a-lot-for-the-clarifications-brian">Thanks a lot for the clarifications Brian!</h4>

<p><a href="https://www.blogger.com/profile/04233325205386980154" title="noreply@blogger.com">segaa</a> - <time datetime="2011-11-10T22:33:59.207-06:00">Nov 5, 2011</time></p>

<p>Thanks a lot for the clarifications Brian!
<hr /></p>

<h4 id="hi-i-m-not-sure-if-i-m-missing-something">Hi. I&rsquo;m not sure if I&rsquo;m missing something&hellip;</h4>

<p><a href="https://www.blogger.com/profile/10839436531140017459" title="noreply@blogger.com">wywialm</a> - <time datetime="2012-04-10T05:34:55.395-05:00">Apr 2, 2012</time></p>

<p>Hi.</p>

<p>I&rsquo;m not sure if I&rsquo;m missing something, but I have no idea how to download the blotter package from r-forge project page. Is the package available for download and in case it is, could you give me a hint how to install it properly (preferably in R-2.15.0)</p>

<p>Regards,<br />
Matt
<hr /></p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/fosstrading/tags/blotter/" rel="tag">blotter</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/fosstrading/tags/code/" rel="tag">Code</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<div class="authorbox__header">
		<span class="authorbox__name">About Joshua Ulrich</span>
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/fosstrading/2009/11/tactical-asset-allocation-using-blotter/" rel="prev">
			<span class="post-nav__caption">«&thinsp;Previous</span>
			<p class="post-nav__post-title">Tactical asset allocation using blotter</p>
		</a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/fosstrading/2010/01/lspm-examples/" rel="next">
			<span class="post-nav__caption">Next&thinsp;»</span>
			<p class="post-nav__post-title">LSPM Examples</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<label>
			<input class="widget-search__field" type="search" placeholder="SEARCH..." value="" name="q" aria-label="SEARCH...">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="https://joshuaulrich.github.io/fosstrading/" />
	</form>
</div><div>
    <a title="CSI Data" href="https://www.csicheckout.com/cgi-bin/ua_order_form_nw.pl?referrer=JU" target="_blank">
        <img class="csi-banner" src="/csi-banner.jpg" width="160" height="312">
    </a>
    <p>
</div>

<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/fosstrading/2020/03/quantmod04-16-on-cran/">quantmod_0.4-16 on CRAN</a></li>
			<li class="widget__item"><a class="widget__link" href="/fosstrading/2019/10/microbenchmark14-7-on-cran/">microbenchmark_1.4-7 on CRAN</a></li>
			<li class="widget__item"><a class="widget__link" href="/fosstrading/2019/03/quantmod04-14-on-cran/">quantmod_0.4-14 on CRAN</a></li>
			<li class="widget__item"><a class="widget__link" href="/fosstrading/2018/11/xts-011-2-on-cran/">xts 0.11-2 on CRAN</a></li>
			<li class="widget__item"><a class="widget__link" href="/fosstrading/2018/09/xts-011-1-on-cran/">xts 0.11-1 on CRAN</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/api/" title="API">API</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/blotter/" title="blotter">blotter</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/code/" title="Code">Code</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/data/" title="Data">Data</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/deoptim/" title="DEoptim">DEoptim</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/drawdown/" title="Drawdown">Drawdown</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/events/" title="Events">Events</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/examples/" title="Examples">Examples</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/excel/" title="Excel">Excel</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/historical-data/" title="HIstorical Data">HIstorical Data</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/ibrokers/" title="IBrokers">IBrokers</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/interactive-brokers/" title="Interactive Brokers">Interactive Brokers</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/lspm/" title="LSPM">LSPM</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/portfolioanalytics/" title="PortfolioAnalytics">PortfolioAnalytics</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/quantmod/" title="quantmod">quantmod</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/quantstrat/" title="quantstrat">quantstrat</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/r/" title="R">R</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/releases/" title="Releases">Releases</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/reviews/" title="Reviews">Reviews</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/ttr/" title="TTR">TTR</a>
		<a class="widget-taglist__link widget__link btn" href="/fosstrading/tags/xts/" title="xts">xts</a>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 FOSS Trading.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/fosstrading/js/menu.js"></script>
</body>
</html>