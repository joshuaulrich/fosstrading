<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>RSI(2) with Position Sizing - FOSS Trading</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="RSI(2) with Position Sizing" />
<meta property="og:description" content="Though it&rsquo;s more than two weeks later, here&rsquo;s the second post in the series that will demonstrate how to build, test, and implement a trading strategy with R. You can find the first post here.
The first post replicated this simple RSI(2) strategy from the MarketSci Blog. This second post will demonstrate how to replicate this strategy that scales in/out of RSI(2).
A couple notes before moving to the code:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.fosstrading.com/2009/05/rsi2-with-position-sizing.html" />
<meta property="article:published_time" content="2009-05-01T20:58:00-05:00" />
<meta property="article:modified_time" content="2009-05-01T20:58:00-05:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/fosstrading.css"><link rel="stylesheet" href="/syntax.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-3314405-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    <script data-ad-client="ca-pub-7427704313601198" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="FOSS Trading" rel="home">
				<div class="logo__title">FOSS Trading</div>
				<div class="logo__tagline">Algorithmic Trading with Free Open Source Software</div>
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/page/disclosures/">
				
				<span class="menu__text">Disclosures</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/page/enterprise/">
				
				<span class="menu__text">For Enterprise</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RSI(2) with Position Sizing</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2009-05-01T20:58:00-05:00">May 01, 2009</time></div></div>
		</header><div class="content post__content clearfix">
			<p>Though it&rsquo;s more than two weeks later, here&rsquo;s the second post in the series that will demonstrate how to build, test, and implement a trading strategy with <a href="http://www.r-project.org/">R</a>. You can find the first post <a href="http://blog.fosstrading.com/2009/04/testing-rsi2-with-r.html">here</a>.</p>
<p>The <a href="http://blog.fosstrading.com/2009/04/testing-rsi2-with-r.html">first post</a> replicated this <a href="http://marketsci.wordpress.com/2008/12/09/trading-with-rsi2/">simple RSI(2) strategy</a> from the <a href="http://marketsci.wordpress.com/">MarketSci Blog</a>. This second post will demonstrate how to replicate <a href="http://marketsci.wordpress.com/2008/12/14/trading-strategy-scaling-inout-of-rsi2/">this strategy</a> that scales in/out of RSI(2).</p>
<p>A couple notes before moving to the code:</p>
<ol>
<li>
<p>The rsi2pos() function isn&rsquo;t <em>necessary</em>, but it provides an example of how to define a function. Plus, it enables us to test several ideas with much greater speed and flexibility.</p>
</li>
<li>
<p>The ifelse() function works on entire vectors at once, avoiding costly loops (loops are costly in R because it&rsquo;s an interpreted language). Since we can potentially modify the entire &lsquo;size&rsquo; vector, we must be mindful of the order of the tests.</p>
</li>
</ol>
<p>On to the code!</p>
<blockquote>
<p># Attach the quantmod and TTR packages.<br>
# You can install packages via:<br>
# install.packages(c(&ldquo;quantmod&rdquo;,&ldquo;TTR&rdquo;))<br>
library(quantmod)<br>
library(TTR)</p>
<p># Pull S&amp;P500 index data from Yahoo! Finance<br>
getSymbols(&ldquo;^GSPC&rdquo;, from=&quot;2000-01-01&rdquo;, to=&quot;2008-12-07&rdquo;)</p>
<p># Calculate the RSI indicator<br>
rsi &lt;- RSI(Cl(GSPC),2)</p>
<p># Calculate Close-to-Close returns<br>
# (this assumes we open/close our positions<br>
# at each day&rsquo;s close)<br>
ret &lt;- ROC(Cl(GSPC))<br>
ret[1] &lt;- 0</p>
<p># Define our position-sizing function<br>
rsi2pos &lt;- function(ind, indIncr=5, posIncr=0.25) {<br>
# Inputs:<br>
# ind : indicator vector<br>
# indIncr : indicator value increments/breakpoints<br>
# posIncr : position value increments/breakpoints</p>
<p># Initialize result vector<br>
size &lt;- rep(0,NROW(ind))</p>
<p># Long<br>
size &lt;- ifelse(ind &lt; 4*indIncr, (1-posIncr*3), size)<br>
size &lt;- ifelse(ind &lt; 3*indIncr, (1-posIncr*2), size)<br>
size &lt;- ifelse(ind &lt; 2*indIncr, (1-posIncr*1), size)<br>
size &lt;- ifelse(ind &lt; 1*indIncr, (1-posIncr*0), size)</p>
<p># Short<br>
size &lt;- ifelse(ind &gt; 100-4*indIncr, 3*posIncr-1, size)<br>
size &lt;- ifelse(ind &gt; 100-3*indIncr, 2*posIncr-1, size)<br>
size &lt;- ifelse(ind &gt; 100-2*indIncr, 1*posIncr-1, size)<br>
size &lt;- ifelse(ind &gt; 100-1*indIncr, 0*posIncr-1, size)</p>
<p># Today&rsquo;s position (&lsquo;size&rsquo;) is based on today&rsquo;s<br>
# indicator, but we need to apply today&rsquo;s position<br>
# to the Close-to-Close return at tomorrow&rsquo;s close.<br>
size &lt;- lag(size)</p>
<p># Replace missing signals with no position<br>
# (generally just at beginning of series)<br>
size[is.na(size)] &lt;- 0</p>
<p># Return results<br>
return(size)<br>
}</p>
<p># Calculate signals using the &lsquo;rsi2pos()&rsquo; function<br>
sig &lt;- rsi2pos(rsi, 5, 0.25)</p>
<p># Break out the long (up) and short (dn) signals<br>
sigup &lt;- ifelse(sig &gt; 0, sig, 0)<br>
sigdn &lt;- ifelse(sig &lt; 0, sig, 0)</p>
<p># Calculate equity curves<br>
eq_up &lt;- exp(cumsum(ret*sigup))<br>
eq_dn &lt;- exp(cumsum(ret*sigdn))<br>
eq_all &lt;- exp(cumsum(ret*sig))</p>
<p># Replicate Michael&rsquo;s nice chart (again)<br>
png(filename=&quot;20090430_rsi2_replication.png&rdquo;)<br>
plot.zoo( cbind(eq_up, eq_dn), plot.type=&quot;single&rdquo;,<br>
ylab=c(&ldquo;Long&rdquo;,&ldquo;Short&rdquo;), col=c(&ldquo;green&rdquo;,&ldquo;red&rdquo;),<br>
main=&quot;RSI(2) Strategy, with Position Scaling:\n 2000-01-03 through 2008-12-07&rdquo; )<br>
dev.off()</p>
</blockquote>
<p><a href="http://3.bp.blogspot.com/_8iehP8a8rkE/Sfu9TdIwbsI/AAAAAAAAAFw/XWZ3pQGHdlQ/s1600-h/20090501_rsi2_replication.png"><img src="https://3.bp.blogspot.com/_8iehP8a8rkE/Sfu9TdIwbsI/AAAAAAAAAFw/XWZ3pQGHdlQ/s400/20090501_rsi2_replication.png" alt=""></a></p>
<blockquote>
<p># Calculate signals using the &lsquo;rsi2pos()&rsquo; function<br>
# with new values<br>
sig &lt;- rsi2pos(rsi, 10, 0.3)</p>
<p># Break out the long (up) and short (dn) signals<br>
sigup &lt;- ifelse(sig &gt; 0, sig, 0)<br>
sigdn &lt;- ifelse(sig &lt; 0, sig, 0)</p>
<p># Calculate equity curves<br>
eq_up &lt;- exp(cumsum(ret*sigup))<br>
eq_dn &lt;- exp(cumsum(ret*sigdn))<br>
eq_all &lt;- exp(cumsum(ret*sig))</p>
<p># Re-plot equity curves using updated values<br>
png(filename=&quot;20090501_rsi2_updated.png&rdquo;)<br>
plot.zoo( cbind(eq_up, eq_dn), plot.type=&quot;single&rdquo;,<br>
ylab=c(&ldquo;Long&rdquo;,&ldquo;Short&rdquo;), col=c(&ldquo;green&rdquo;,&ldquo;red&rdquo;),<br>
main=&quot;Updated RSI(2) Strategy, with Position Scaling:\n 2000-01-03 through 2008-12-07&rdquo; )<br>
dev.off()</p>
</blockquote>
<p><a href="http://4.bp.blogspot.com/_8iehP8a8rkE/Sfu-I3e_0SI/AAAAAAAAAGI/c4XOAzKk56g/s1600-h/20090501_rsi2_updated.png"><img src="https://4.bp.blogspot.com/_8iehP8a8rkE/Sfu-I3e_0SI/AAAAAAAAAGI/c4XOAzKk56g/s400/20090501_rsi2_updated.png" alt=""></a><br>
Visual inspection of the charts seems to indicate the updated RSI(2) strategy has slightly higher returns, but more volatility and larger drawdowns.</p>
<p>The <a href="http://cran.r-project.org/web/packages/PerformanceAnalytics/index.html">PerformanceAnalytics</a> package can evaluate the volatility, drawdowns, and related metrics for investing and trading strategies. Â We&rsquo;ll use it in the next post to <a href="http://blog.fosstrading.com/2009/06/rsi2-evaluation.html">evaluate RSI(2)</a>.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/Examples/" rel="tag">Examples</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/Code/" rel="tag">Code</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/2009/04/rfinance-2009-overview.html" rel="prev">
			<span class="post-nav__caption">Â«&thinsp;Previous</span>
			<p class="post-nav__post-title">R/Finance 2009 Overview</p>
		</a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/2009/05/rfinance-2009-presentations-online.html" rel="next">
			<span class="post-nav__caption">Next&thinsp;Â»</span>
			<p class="post-nav__post-title">R/Finance 2009 Presentations Online</p>
		</a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "foss-trading" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<label>
			<input class="widget-search__field" type="search" placeholder="SEARCH..." value="" name="q" aria-label="SEARCH...">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="https://blog.fosstrading.com/" />
	</form>
</div><div>
    <a title="CSI Data" href="https://www.csicheckout.com/cgi-bin/ua_order_form_nw.pl?referrer=JU" target="_blank">
      <img class="csi-banner" src="/csi-banner.jpg" width="160" height="312">
    </a>
    <p>
</div>

<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/2020/03/quantmod04-16-on-cran.html">quantmod_0.4-16 on CRAN</a></li>
			<li class="widget__item"><a class="widget__link" href="/2019/10/microbenchmark14-7-on-cran.html">microbenchmark_1.4-7 on CRAN</a></li>
			<li class="widget__item"><a class="widget__link" href="/2019/03/quantmod04-14-on-cran.html">quantmod_0.4-14 on CRAN</a></li>
			<li class="widget__item"><a class="widget__link" href="/2018/11/xts-011-2-on-cran.html">xts 0.11-2 on CRAN</a></li>
			<li class="widget__item"><a class="widget__link" href="/2018/09/xts-011-1-on-cran.html">xts 0.11-1 on CRAN</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/search/label/API.html" title="API">API</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Code.html" title="Code">Code</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/DEoptim.html" title="DEoptim">DEoptim</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Data.html" title="Data">Data</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Drawdown.html" title="Drawdown">Drawdown</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Events.html" title="Events">Events</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Examples.html" title="Examples">Examples</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Excel.html" title="Excel">Excel</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/HIstorical-Data.html" title="HIstorical Data">HIstorical Data</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/IBrokers.html" title="IBrokers">IBrokers</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Interactive-Brokers.html" title="Interactive Brokers">Interactive Brokers</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/LSPM.html" title="LSPM">LSPM</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/PortfolioAnalytics.html" title="PortfolioAnalytics">PortfolioAnalytics</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/R.html" title="R">R</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Releases.html" title="Releases">Releases</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Reviews.html" title="Reviews">Reviews</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/TTR.html" title="TTR">TTR</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/blotter.html" title="blotter">blotter</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/quantmod.html" title="quantmod">quantmod</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/quantstrat.html" title="quantstrat">quantstrat</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/xts.html" title="xts">xts</a>
	</div>
</div>
<div>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-7427704313601198"
       data-ad-slot="6372007789"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 FOSS Trading.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
