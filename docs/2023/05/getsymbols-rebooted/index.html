<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>getSymbols Rebooted - FOSS Trading</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="getSymbols Rebooted" />
<meta property="og:description" content="quantmod and getSymbols() have been a core part of the R/Finance ecosystem for over 15 years. We want to change some things, but they would break existing code. We can make these changes in the new &lsquo;rfimport&rsquo; package instead." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.fosstrading.com/2023/05/getsymbols-rebooted/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-05-22T10:14:00-05:00" />
<meta property="article:modified_time" content="2023-05-22T10:14:00-05:00" />

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/fosstrading.css"><link rel="stylesheet" href="/syntax.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LT26X44HDL"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LT26X44HDL', { 'anonymize_ip': false });
}
</script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="FOSS Trading" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">FOSS Trading</div>
					<div class="logo__tagline">Algorithmic Trading with Free Open Source Software</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/page/disclosures/">
				
				<span class="menu__text">Disclosures</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/page/enterprise/">
				
				<span class="menu__text">For Enterprise</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">getSymbols Rebooted</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2023-05-22T10:14:00-05:00">May 22, 2023</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/Articles/" rel="category">Articles</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>quantmod and <code>getSymbols()</code> have been a core part of the R/Finance ecosystem for over 15 years. We want to change some things, but they would break existing code. We can make these changes in the new <a href="https://github.com/joshuaulrich/rfimport/">&lsquo;rfimport&rsquo;</a> package instead.</p>
<h3 id="background">Background</h3>
<p>The quantmod package has been a core part of the R/Finance ecosystem for over 15 years. It&rsquo;s awesome that the package is so popular, but that also comes with responsibility to maintain backward compatibility. Breaking changes may break code used for making business decisions, research, production, blog posts, books, courses, answers on <a href="https://stackoverflow.com">stackoverflow</a>, and much more. We take this responsibility seriously, and do our best to keep functions backward compatible. Sometimes breaking changes are necessary (e.g. bug fixes, changes to external data sources, etc.), but we do our best to make them carefully, with plenty of warning and lead time for users to adjust their code.</p>
<h3 id="motivation">Motivation</h3>
<p>There are things in quantmod that we want to change, but they would certainly break existing code. No matter how much we&rsquo;d like to make those changes, we can&rsquo;t justify breaking a large portion of the code our community has written in the past 15+ years.</p>
<p>We can create a new package instead of making these changes in quantmod. <a href="https://github.com/joshuaulrich/rfimport/">&lsquo;rfimport&rsquo;</a> is where we will work on new implementations that improve on the pieces in <code>getSymbols()</code> that we would like to change. This code is <em>extremely alpha</em>. This is the time to provide feedback, suggestions, feature requests, etc. Know that we will break things, maybe without warning. You should consider the API unstable until the 1.0.0 release.</p>
<h3 id="refresher-on-how-getsymbols-works">Refresher on how <code>getSymbols()</code> works</h3>
<p>By default <code>getSymbols()</code> creates objects in the environment it&rsquo;s called from, and it returns the value of the <code>Symbols</code> argument. It&rsquo;s good practice for functions to avoid changing anything in the user&rsquo;s environment (this is called having side-effects). It&rsquo;s better for functions to only return a value, like <code>getSymbols(..., auto.assign = FALSE)</code> does. <code>getSymbols()</code> does not support <code>auto.assign = FALSE</code> for more than one symbol.</p>
<p><code>getSymbols()</code> also uses functionality that was formerly provided by the archived <a href="https://cran.r-project.org/package=Defaults">&lsquo;Defaults&rsquo;</a> package. This functionality allows users to set default values for <code>getSymbols()</code> source method arguments (e.g. <code>return.class = &quot;data.frame&quot;</code>). This is also a side-effect because it makes <code>getSymbols()</code> depend on something other than argument values.</p>
<p><code>getSymbols()</code> specifies the data sources via its <code>src</code> argument, and uses the <code>src</code> argument to determine which source method to use (e.g. <code>getSymbols(&quot;SPY&quot;, src = &quot;yahoo&quot;)</code> will call <code>getSymbols.yahoo(&quot;SPY&quot;)</code> behind the scenes). This is essentially method dispatch, but done manually rather than using R&rsquo;s built-in S3 functionality.</p>
<h1 id="what-weve-learned">What we&rsquo;ve learned</h1>
<ol>
<li>We should avoid the side-effect of creating objects in the calling environment.</li>
<li>Data sources should use S3 method dispatch, and documentation needs to be easier to find.</li>
<li>Stock ticker symbology is a pain and we need a better way to handle it.</li>
<li>We need a way to provide functionality like the <a href="https://cran.r-project.org/package=Defaults">&lsquo;Defaults&rsquo;</a> package did, but without side-effects.</li>
</ol>
<h3 id="1-automatically-creating-objects">1. Automatically creating objects</h3>
<p><code>getSymbols()</code> creates an object for every value in the <code>Symbols</code> argument. This isn&rsquo;t an issue for a few symbols, but it clutters the environment when there are several hundred symbols. You can load all the symbols into a separate environment, but that&rsquo;s not a pattern most users are familiar with.</p>
<p>We wanted to remove the ability to load objects into the calling environment, and even created a warning about changing <code>auto.assign = FALSE</code> as the default for <code>getSymbols()</code> and recommending users replace their <code>getSymbols()</code> call with the <code>loadSymbols()</code> function that already exists. But we ultimately decided breaking the community&rsquo;s code wasn&rsquo;t worth it.</p>
<p>Automatically creating objects makes it cumbersome to put prices for all symbols into one object. This is a common use case and there are several steps. It should be possible with one or two function calls. Here&rsquo;s an example.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">symbols</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;SPY&#34;</span><span class="p">,</span> <span class="s">&#34;AAPL&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">getSymbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Put all the prices into one xts object,</span>
</span></span><span class="line"><span class="cl"><span class="n">prices</span> <span class="o">&lt;-</span> <span class="nf">do.call</span><span class="p">(</span><span class="n">merge</span><span class="p">,</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">get</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># or</span>
</span></span><span class="line"><span class="cl"><span class="n">prices</span> <span class="o">&lt;-</span> <span class="nf">do.call</span><span class="p">(</span><span class="n">merge</span><span class="p">,</span> <span class="nf">mget</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Extract only the Close prices</span>
</span></span><span class="line"><span class="cl"><span class="n">close_prices</span> <span class="o">&lt;-</span> <span class="nf">Cl</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Remove &#34;.Close&#34; suffix so close_prices[, &#34;SPY&#34;] works</span>
</span></span><span class="line"><span class="cl"><span class="nf">colnames</span><span class="p">(</span><span class="n">close_prices</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">sub</span><span class="p">(</span><span class="s">&#34;.Close&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">close_prices</span><span class="p">))</span>
</span></span></code></pre></div><p>Automatically creating objects also makes passing all the data to another function awkward. It causes users to do things like:</p>
<ul>
<li>Call <code>getSymbols()</code> in any function that needs data, which may mean the same data is imported multiple times.</li>
<li>Pass the same <code>symbols</code> object to <code>getSymbols()</code> and the other function. Then the other function searches through environments to find the objects with named with those <code>symbols</code>.</li>
<li>Users could put all the data in an environment and use that as an argument to the function, but I haven&rsquo;t seen many people use this pattern.</li>
</ul>
<h3 id="2-data-source-methods">2. Data source methods</h3>
<p>Different <code>getSymbols()</code> source methods can (or may need to) have different arguments. Ideally the source methods wouldn&rsquo;t be exported because users shouldn&rsquo;t call them directly (users should call <code>getSymbols(&quot;SPY&quot;, src = &quot;yahoo&quot;)</code> instead of <code>getSymbols.yahoo(&quot;SPY&quot;)</code>). It&rsquo;s hard to find documentation for unexported functions, which means it&rsquo;s hard to know what arguments are available for each source method.</p>
<p>The source methods are named like S3 methods even though <code>getSymbols()</code> isn&rsquo;t a generic function and the source methods aren&rsquo;t actual S3 methods. This has the potential to create odd behavior that would confuse users.</p>
<h3 id="3-ticker-symbology">3. Ticker symbology</h3>
<p>There are two major issues with ticker symbols.</p>
<ol>
<li>Exchanges and data providers sometimes use different ticker symbols for the same security.</li>
<li>Some ticker symbols are not valid R object names.</li>
</ol>
<p>Another issue is when the ticker symbol is similar to the name of one of the price columns. This has come up several times with Lowe&rsquo;s (LOW). The <code>Lo()</code> and <code>OHLC()</code> functions think all of the columns with the ticker symbol in the column name are the low price for the period.</p>
<h4 id="same-security-different-ticker">Same security, different ticker</h4>
<p>This isn&rsquo;t <code>getSymbols()</code>&rsquo;s fault and it&rsquo;s out of our control, but it could be handled better. Exchange and data source symbology is awful. Identifiers for the same series are often different across exchanges and data providers. For example: the symbol for Berkshire Hathaway B-class shares is &ldquo;BRK-B&rdquo; for Yahoo Finance, &ldquo;BRK/B&rdquo; for the SIP (Securities Information Processor), &ldquo;BRK B&rdquo; for ICE, and probably &ldquo;BRK.B&rdquo; somewhere else.</p>
<p>This is a difficult problem and will likely take a lot of effort to get right. Therefore it won&rsquo;t be a high priority initially.</p>
<h4 id="invalid-r-object-names">Invalid R object names</h4>
<p><code>getSymbols()</code> tries to create objects with valid R names, but only does so for <em>some</em> symbols that aren&rsquo;t valid R object names. For example, <code>BRK-B</code>, <code>BRK B</code>, and <code>BRK/B</code> aren&rsquo;t valid R objects names because valid names start with a letter or a dot (<code>.</code>), and can only contain letters, numbers, a dot, or an underscore.</p>
<p>Here are some common examples of ticker symbology woes:</p>
<p><code>^DJI</code> isn&rsquo;t a valid R object name because it starts with <code>^</code>. So <code>getSymbols()</code> creates an object with the <code>^</code> removed. But then you can&rsquo;t use the code below to put all the prices into one object. Also notice that <code>getSymbols()</code> <em>returns</em> <code>&quot;^DJI&quot;</code> even though it creates an object with a different name.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">symbols</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;^DJI&#34;</span><span class="p">,</span> <span class="s">&#34;BRK-B&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">getSymbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">## [1] &#34;^DJI&#34; &#34;BRK-B&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">prices</span> <span class="o">&lt;-</span> <span class="nf">do.call</span><span class="p">(</span><span class="n">merge</span><span class="p">,</span> <span class="nf">mget</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">## Error: value for &#39;^DJI&#39; not found</span>
</span></span></code></pre></div><p>You have to remove the leading <code>^</code> manually. And you have to set <code>fixed = TRUE</code> in the call to <code>sub()</code> because <code>^</code> is a special character in regular expressions. <em>Sigh</em>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">prices</span> <span class="o">&lt;-</span> <span class="nf">do.call</span><span class="p">(</span><span class="n">merge</span><span class="p">,</span> <span class="nf">mget</span><span class="p">(</span><span class="nf">sub</span><span class="p">(</span><span class="s">&#34;^&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">fixed</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)))</span>
</span></span></code></pre></div><p>Recall that <code>BRK-B</code> also isn&rsquo;t a valid R name because of the <code>-</code>. But it wasn&rsquo;t an issue in the code above because <code>getSymbols()</code> made an object named <code>BRK-B</code>, not an object with a valid R name. This is confusing for users because they can&rsquo;t easily access that object (i.e. <code>head(BRK-B)</code> is an error). This is a pervasive issue for several foreign exchanges with tickers that begin with numbers (e.g. <code>000001.SZ</code>).</p>
<p>Another issue with symbols that aren&rsquo;t valid R object names is that many R functions will convert column names into valid R object names, including <code>merge.xts()</code>. So you can&rsquo;t use the input symbol to subset the resulting xts object. Here&rsquo;s an example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Extract the close prices and remove &#34;.Close&#34; suffix</span>
</span></span><span class="line"><span class="cl"><span class="n">close_prices</span> <span class="o">&lt;-</span> <span class="nf">Cl</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">colnames</span><span class="p">(</span><span class="n">close_prices</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">sub</span><span class="p">(</span><span class="s">&#34;.Close&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">close_prices</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Extract the close price for &#34;BRK-B&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">close_prices[</span><span class="p">,</span> <span class="s">&#34;BRK-B&#34;</span><span class="n">]</span>
</span></span><span class="line"><span class="cl"><span class="c1">## Error in `[.xts`(close_prices, , &#34;BRK-B&#34;) : subscript out of bounds</span>
</span></span><span class="line"><span class="cl"><span class="nf">colnames</span><span class="p">(</span><span class="n">close_prices</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">## [1] &#34;DJI&#34;   &#34;BRK.B&#34;</span>
</span></span></code></pre></div><p><code>setSymbolLookup()</code> exists to help with things like this, but it&rsquo;s another function users have to learn to use and my experience is that most users don&rsquo;t know about <code>setSymbolLookup()</code>. I just had to look at the source to figure out how to use it to make <code>getSymbols()</code> return a valid R object for <code>&quot;BRK-B&quot;</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">setSymbolLookup</span><span class="p">(</span><span class="n">BRK.B</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;BRK-B&#34;</span><span class="p">,</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&#34;yahoo&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p>If I have to look at the source code to figure out how to do this, users don&rsquo;t have a chance. You may think, &ldquo;but you could document how to do this&rdquo;, but writing documentation isn&rsquo;t fun. And who reads the documentation anyway? ;-)</p>
<h3 id="4-defaults-functionality">4. &lsquo;Defaults&rsquo; functionality</h3>
<p>The &lsquo;Defaults&rsquo; functionality in quantmod comes from the archived <a href="https://cran.r-project.org/package=Defaults">&lsquo;Defaults&rsquo;</a> package. This functionality allows users to set new default argument values to any <code>getSymbols()</code> source function. This is helpful because it makes importing easier. But it means <code>getSymbols()</code> relies on something other than its parameter values, and it&rsquo;s good practice to avoid side-effects like this.</p>
<p>This gave users the ability to set preferences like return class, periodicity (e.g. hourly, daily, monthly), connection settings (e.g. credentials, API keys).</p>
<h1 id="rfimport-design-and-features">&lsquo;rfimport&rsquo; design and features</h1>
<p>The design of <a href="https://github.com/joshuaulrich/rfimport/">&lsquo;rfimport&rsquo;</a> is influenced by the <a href="https://cran.r-project.org/web/packages/DBI/index.html"><code>DBI</code></a> package, which provides a set of generic &lsquo;database interface&rsquo; functions. Users create connection objects by creating a &lsquo;driver&rsquo; object for the specific database and passing that to <code>dbConnect()</code>. Then you pass that connection object to the other <code>DBI</code> functions. For example, to query an execute a statement for a PostgreSQL database:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">RPostgreSQL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">driver</span> <span class="o">&lt;-</span> <span class="nf">PostgreSQL</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">conn</span> <span class="o">&lt;-</span> <span class="n">DBI</span><span class="o">::</span><span class="nf">dbConnect</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">student_count</span> <span class="o">&lt;-</span> <span class="n">DBI</span><span class="o">::</span><span class="nf">dbGetQuery</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#34;select count(*) from students&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>The <a href="https://github.com/joshuaulrich/rfimport/">&lsquo;rfimport&rsquo;</a> <code>sym_yahoo()</code> function corresponds to the <code>PostgreSQL()</code> function in the example above. And the <code>import_ohlc()</code> function pulls the data like <code>DBI::dbGetQuery()</code>. For example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">rfimport</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The sym_* functions are a combination of the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># driver, connection, and query in DBI</span>
</span></span><span class="line"><span class="cl"><span class="n">sym</span> <span class="o">&lt;-</span> <span class="nf">sym_yahoo</span><span class="p">(</span><span class="s">&#34;SPY&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Import some data from Yahoo Finance</span>
</span></span><span class="line"><span class="cl"><span class="n">spy</span> <span class="o">&lt;-</span> <span class="nf">import_ohlc</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="symbol-specification">Symbol specification</h3>
<p>The package introduces a new virtual S3 class <code>&quot;symbol_spec&quot;</code> as the basis for creating sub-classes that hold all necessary information to connect to a data source. This virtual class allows users to combine symbols from different data sources into a single vector. For example: <code>import_ohlc_collection(c(sym_yahoo(&quot;SPY&quot;), sym_tiingo(&quot;DIA&quot;)))</code> will import data for &ldquo;SPY&rdquo; from <a href="https://finance.yahoo.com/">Yahoo Finance</a> and data for &ldquo;DIA&rdquo; from <a href="https://www.tiingo.com/">Tiingo</a>.</p>
<p>Each data source will have its own <code>symbol_spec</code> constructor. The constructor will have an argument for the vector of symbols and other arguments for all the other data source connection settings. It will return an object that inherits from the new virtual <code>symbol_spec</code> For example <code>sym_yahoo()</code> will return a <code>c(&quot;yahoo&quot;, &quot;symbol_spec&quot;)</code> class vector.</p>
<p>The help page for the symbol spec constructors can also document the import methods that the data source supports. So <code>help(&quot;sym_yahoo&quot;)</code> would also contain information about <code>import_ohlc.yahoo()</code> and <code>import_ohlc_collection.yahoo()</code>. That way, users don&rsquo;t need to know the name of the data source method in order to find its documentation.</p>
<h3 id="ticker-symbology">Ticker symbology</h3>
<p>The package would standardize how index tickers are specified. One possibility is to prefix the ticker with an <code>i</code> or <code>i_</code> (e.g. <code>iDJI</code> or <code>i_DJI</code>).</p>
<p>It would also standardize how to specify share classes, warrants, preferred, etc. One possibility is to use an underscore to identify share classes, a lowercase &lsquo;w&rsquo; for warrants, and a lowercase &lsquo;p&rsquo; for preferred. For example, <code>BRK_B</code> for Berkshire Hathaway B shares, <code>FOOw</code> for warrants, <code>BARp</code> for preferred. We could also include a translation table and/or function. This would take a lot of effort to do correctly.</p>
<p>An easier alternative would be creating a way to map source symbols to user-defined values. It makes the most sense to do this is the <code>sym_&lt;source&gt;()</code> constructor. But how should the mapping be specified? Some possibilities:</p>
<ul>
<li><code>sym_yahoo(BRK.B = list(symbol = &quot;BRK-B&quot;))</code></li>
<li><code>sym_yahoo(c(BRK.B = &quot;BRK-B&quot;, &quot;DIA&quot;))</code></li>
<li><code>sym_yahoo(c(&quot;BRK.B&quot;, &quot;DIA&quot;), sym_db = list(BRK.B = &quot;BRK-B&quot;))</code></li>
</ul>
<h3 id="generic-import-functions">Generic import functions</h3>
<p>The package will have generic functions <code>import_ohlc()</code> and <code>import_ohlc_collection()</code> to dispatch on <code>symbol_spec</code> sub-classes. <code>import_ohlc()</code> only handles a single symbol and returns one xts object. <code>import_ohlc_collection()</code> will return a list of xts objects for one or more symbols.</p>
<p>Other generic import functions may be added in the future. It may make sense to include generic <code>import</code> functions that return specific types of data. For example: <code>import_statements()</code> for financial statements, and <code>import_bbo()</code> for best bid and offer.</p>
<p>The generics will have a <code>symbol_spec</code>, <code>dates</code>, <code>periodicity</code>, and <code>...</code> arguments.</p>
<p><code>dates</code> can be either an ISO 8601 date interval (e.g. <code>dates = &quot;2021-01-01/2021-12-31&quot;</code>) or a two-element vector with the start and end dates (e.g. <code>dates = c(&quot;2021-01-01&quot;, &quot;2021-12-31&quot;)</code>). The vector can be Date, POSIXct, or a character that is coercible to one of those two classes.</p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># one symbol returned as an xts object</span>
</span></span><span class="line"><span class="cl"><span class="n">spy</span> <span class="o">&lt;-</span> <span class="nf">import_ohlc</span><span class="p">(</span><span class="nf">sym_yahoo</span><span class="p">(</span><span class="s">&#34;SPY&#34;</span><span class="p">),</span> <span class="n">dates</span> <span class="o">=</span> <span class="s">&#34;2021/2022&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># two symbols returned as a list of xts objects</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks</span> <span class="o">&lt;-</span> <span class="nf">sym_tiingo</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;AAPL&#34;</span><span class="p">,</span> <span class="s">&#34;NFLX&#34;</span><span class="p">))</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">import_ohlc_collection</span><span class="p">(</span><span class="n">dates</span> <span class="o">=</span> <span class="s">&#34;2021-03-01/2022-11-31&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>The <code>periodicity</code> argument specifies the interval between data points (e.g. daily, monthly, 15-minute). The data source determines the possible periodicity values, so the data source method is responsible for ensuring the requested periodicity value is available from the data source. <a href="https://github.com/joshuaulrich/rfimport/">&lsquo;rfimport&rsquo;</a> will provide a standard way to specify the periodicity values. Then the source methods can translate those values into the value source needs. For example, one data source may use &ldquo;monthly&rdquo; for monthly data and another may use &ldquo;months&rdquo;. Users would set <code>periodicity = &quot;months&quot;</code> for either source and the source method would translate the value to &ldquo;monthly&rdquo;.</p>
<h3 id="data-source-methods">Data source methods</h3>
<p>Each data source will have a S3 method for the relevant import generics, rather than a <code>src</code> argument like <code>getSymbols()</code>. Calling <code>import_ohlc(sym_yahoo(&quot;SPY&quot;))</code> will call the corresponding <code>import_ohlc.yahoo()</code> method to import data from <a href="https://finance.yahoo.com">Yahoo Finance</a>. <code>import_ohlc(sym_tiingo(&quot;DIA&quot;))</code> will call <code>import_ohlc.tiingo()</code> to import data from <a href="https://api.tiingo.com/">Tiingo</a>.</p>
<h4 id="returned-data">Returned data</h4>
<p>The built-in data source methods will automatically include dividends and splits (when available) for daily OHLCV data. They will be included as attributes on the returned OHLCV object. This will allow users to switch between adjusted and unadjusted prices without having to re-download the data.</p>
<p>The built-in data sources methods also will not include the series symbol in the OHLCV column names like <code>getSymbols()</code> currently does. It may make sense to include an attribute with the &ldquo;source symbol&rdquo; and the &ldquo;R symbol&rdquo; on the returned xts object (e.g. <code>src_symbol = &quot;^DJI&quot;</code> and <code>r_symbol = &quot;iDJI&quot;)</code>. Then that attribute can be used later as part of the column names.</p>
<h3 id="providing-defaults-functionality">Providing &lsquo;Defaults&rsquo; functionality</h3>
<p>Though we want to avoid side-effects, we probably want to provide a way to set credentials so they do not have to be provided for every import call.</p>
<p>We could provide this functionality in a pure way by creating an <code>options</code> object that holds a list of values. Users would create this object once and pass it to the relevant <a href="https://github.com/joshuaulrich/rfimport/">&lsquo;rfimport&rsquo;</a> function (either <code>sym_&lt;source&gt;()</code> or <code>import_ohlc()</code>). The default options could be created by a function like <code>sym_&lt;source&gt;_options()</code>. This would be similar to the &lsquo;control&rsquo; arguments to many optimization routines (e.g. <code>DEoptim.control()</code>).</p>
<h1 id="open-questions-and-considerations">Open questions and considerations</h1>
<h3 id="how-should-we-specify-the-class-of-the-returned-object">How should we specify the class of the returned object?</h3>
<ul>
<li>
<p>Set it via a <code>return_class</code> argument in the <code>symbol_spec</code> constructor</p>
<ul>
<li>PRO: each source is likely to have a specific data structure, and it wouldn&rsquo;t require creating a generic <code>import</code> function for each return type.</li>
<li>CON: allows the potential for one call to an <code>import_*_collection()</code> function to return a list of heterogeneous objects.</li>
</ul>
</li>
<li>
<p>Set it via a <code>return_class</code> argument in the <code>import</code> method</p>
<ul>
<li>PRO: the method would return a list of objects that are all the same class.</li>
<li>CON: the generic and/or the default <code>import</code> method would need a <code>return_class</code> argument.</li>
</ul>
</li>
<li>
<p>Create a new generic <code>import</code> functions for each return class</p>
<ul>
<li>PRO: makes it clear what the <code>import</code> function returns.</li>
<li>CON: namespace clutter, don&rsquo;t want generics for <em>every</em> class. Possibly provide generics for most widely used non-xts classes: data.frame, data.table, tibble, tsibble.</li>
</ul>
</li>
<li>
<p>The symbol specification can store a function that controls what data is returned. This doesn&rsquo;t seem appealing because it adds complexity and the user could call that function after the data is returned. For example: <code>sym_yahoo(&quot;SPY&quot;, return_func = as.data.table)</code>.</p>
</li>
</ul>
<h3 id="how-can-we-make-it-easier-to-manipulate-results">How can we make it easier to manipulate results?</h3>
<p>The most common use case is making a wide xts object with close prices from a list of xts objects. This currently requires several steps that are likely unfamiliar to most users. It should be possible with one or two function calls. We can consider Garrett See&rsquo;s <a href="https://github.com/gsee/qmao">qmao</a> package for inspiration. For example, use &lsquo;price frames&rsquo; to replace <code>do.call(merge, list_of_xts_objects)</code>.</p>
<p>There are lots of other common manipulations, like aggregating to a higher periodicity or applying a function to many symbols&rsquo; data. The import functions will return something list-like, so users can use <code>lapply()</code> to apply any other function to each series.</p>
<h1 id="i-need-your-help">I need your help!</h1>
<p>I don&rsquo;t want to do this in a vacuum. Please try the new package, provide feedback, suggestions, feature requests, and help clarify documentation.</p>
<p>I need to know how you&rsquo;re using <code>getSymbols()</code> and how you would use the new package. I&rsquo;m not omniscient, so your feedback will be extremely valuable!</p>
<div class="container" role="main">
  <div class="row">
    <hr>
    <p>If you love using my open-source work (e.g.
      <a href="https://cran.r-project.org/package=quantmod">quantmod</a>,
      <a href="https://cran.r-project.org/package=TTR">TTR</a>,
      <a href="https://cran.r-project.org/package=xts">xts</a>,
      <a href="https://cran.r-project.org/package=IBrokers">IBrokers</a>,
      <a href="https://cran.r-project.org/package=microbenchmark">microbenchmark</a>,
      <a href="https://github.com/braverock/blotter/">blotter</a>,
      <a href="https://github.com/braverock/quantstrat/">quantstrat</a>,
      etc.), you can give back by <a href="https://github.com/sponsors/joshuaulrich/">sponsoring me on GitHub</a>. I truly appreciate anything you&rsquo;re willing and able to give!</p>
  </div>
</div>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/quantmod/" rel="tag">quantmod</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/R/" rel="tag">R</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>



<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "foss-trading" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<label>
			<input class="widget-search__field" type="search" placeholder="SEARCH…" value="" name="q" aria-label="SEARCH…">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="https://blog.fosstrading.com/">
	</form>
</div>
<link href="//cdn-images.mailchimp.com/embedcode/classic-071822.css" rel="stylesheet" type="text/css">
<style type="text/css">
#mc_embed_signup{background:#fff; clear:left; font:12px Helvetica,Arial,sans-serif;}
 
</style>
<div id="mc_embed_signup">
    <form action="https://fosstrading.us9.list-manage.com/subscribe/post?u=3b596c57e89d8db5b99daf4ff&amp;id=85bd253834&amp;f_id=00fb1ce1f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_self">
        <div id="mc_embed_signup_scroll">
        <h2>Subscribe to email updates</h2>
        <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
<div class="mc-field-group">
<label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
</label>
<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" required>
<span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span>
</div>
<div class="mc-field-group">
<label for="mce-FNAME">First Name </label>
<input type="text" value="" name="FNAME" class="" id="mce-FNAME">
<span id="mce-FNAME-HELPERTEXT" class="helper_text"></span>
</div>
<div class="mc-field-group">
<label for="mce-LNAME">Last Name </label>
<input type="text" value="" name="LNAME" class="" id="mce-LNAME">
<span id="mce-LNAME-HELPERTEXT" class="helper_text"></span>
</div>
<div class="mc-field-group input-group">
    <strong>Interests </strong>
    <ul><li>
    <input type="checkbox" value="1" name="group[53492][1]" id="mce-group[53492]-53492-0" checked>
    <label for="mce-group[53492]-53492-0">R package releases</label>
</li>
<li>
    <input type="checkbox" value="2" name="group[53492][2]" id="mce-group[53492]-53492-1" checked>
    <label for="mce-group[53492]-53492-1">Everything else</label>
</li>
</ul>
    <span id="mce-group[53492]-HELPERTEXT" class="helper_text"></span>
</div>
<div id="mce-responses" class="clear foot">
<div class="response" id="mce-error-response" style="display:none"></div>
<div class="response" id="mce-success-response" style="display:none"></div>
</div>    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3b596c57e89d8db5b99daf4ff_85bd253834" tabindex="-1" value=""></div>
        <div class="optionalParent">
            <div class="clear foot">
                <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
                <p class="brandingLogo"><a href="http://eepurl.com/ijAV-n" title="Mailchimp - email marketing made easy and fun"><img src="https://eep.io/mc-cdn-images/template_images/branding_logo_text_dark_dtp.svg"></a></p>
            </div>
        </div>
    </div>
</form>
</div>


<div>
    <a title="CSI Data" href="https://www.csicheckout.com/cgi-bin/ua_order_form_nw.pl?referrer=JU" target="_blank">
      <img class="csi-banner" src="/csi-banner.jpg" width="160" height="312">
    </a>
    <p>
</div>

<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/2023/06/running-timebase-in-docker/">Running TimeBase in Docker</a></li>
			<li class="widget__item"><a class="widget__link" href="/2023/06/streaming-data-with-timebase/">Streaming Market Data with TimeBase</a></li>
			<li class="widget__item"><a class="widget__link" href="/2023/05/getsymbols-rebooted/">getSymbols Rebooted</a></li>
			<li class="widget__item"><a class="widget__link" href="/2023/04/xts-0-13-1-on-cran/">xts_0.13.1 on CRAN</a></li>
			<li class="widget__item"><a class="widget__link" href="/2023/04/quantmod-0-4-22-on-cran/">quantmod_0.4.22 on CRAN</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/search/label/API/" title="API">API</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Code/" title="Code">Code</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/DEoptim/" title="DEoptim">DEoptim</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Data/" title="Data">Data</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Drawdown/" title="Drawdown">Drawdown</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Events/" title="Events">Events</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Examples/" title="Examples">Examples</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Excel/" title="Excel">Excel</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Historical-Data/" title="Historical Data">Historical Data</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/IBrokers/" title="IBrokers">IBrokers</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Interactive-Brokers/" title="Interactive Brokers">Interactive Brokers</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/LSPM/" title="LSPM">LSPM</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/PortfolioAnalytics/" title="PortfolioAnalytics">PortfolioAnalytics</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/R/" title="R">R</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Releases/" title="Releases">Releases</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/Reviews/" title="Reviews">Reviews</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/TTR/" title="TTR">TTR</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/TimeBase/" title="TimeBase">TimeBase</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/blotter/" title="blotter">blotter</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/quantmod/" title="quantmod">quantmod</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/quantstrat/" title="quantstrat">quantstrat</a>
		<a class="widget-taglist__link widget__link btn" href="/search/label/xts/" title="xts">xts</a>
	</div>
</div><div>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-7427704313601198"
       data-ad-slot="6372007789"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 FOSS Trading.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>